### 缓存

#### 1. Redis 主从同步

> 1. slave 服务器向 master 发送 psync 命令
> 2. master 接收到 psync 命令后会进行 BGSAVE 命令生成 RDB 快照
> 3. master 将生成完的 RDB 文件推送给 slave
> 4. slave 接收到文件后载入 RDB 快照，并将数据库状态变更为 master 在执行 BGSAVE 时的状态一致。
> 5. master 发送保存在缓冲区里的所有写命令
> 6. slave 执行这些写命令 

#### 2. Redis 数据丢失

> RDB 和 AOF 

#### 3. Redis 中有几种类型 & 各自底层怎么实现的 & 项目中哪个地方用了什么类型，怎么使用的

> string：
>
> hash：
>
> list：
>
> set：
>
> zset：
>
> bitmap：位集合
>
> hyperloglog：是用来做基数统计的算法。用于估计一个set中元素数量的概率性的数据结构。
>
> Geospatial Indexes：地理空间索引
>
> Streams：流信息

#### 4. Redis 如何实现分布式锁，zk 如何实现分布式锁，两者的区别。

**Redis：**SET key value NX PX time。

**ZK：**临时有序节点。

#### 5. 如果 service 还没执行完，分布式锁在 redis 中已经过期了，怎么解决这种问题

思路一：任务执行的时候，开辟一个守护线程，在守护线程中每隔一段时间重新设置过期时间。

思路二：通过 Redisson 中的看门狗来实现。



#### 6. redis 是单线程的还是多线程的，为什么这么快

Redis 执行命令的核心模块是单线程的。

 Redis 通过多线程方式在后台删除对象、以及通过 Redis 模块实现的阻塞命令等。

> 1. 基于内存
> 2. 结构简单，对数据操作也简单，Redis 中的数据结构是专门进行设计的
> 3. 单线程，避免了不必要的上下文切换和竞争条件
> 4. 使用多路 I/O 复用模型，非阻塞 IO
> 5. 使用底层模型不同，它们之间底层实现方式以及与客户端之间通信的应用协议不一样，Redis 直接自己构建了 VM 机制 ，因为一般的系统调用系统函数的话，会浪费一定的时间去移动和请求

#### 7. 多路复用的几种方式以及区别

**多路 I/O 复用模型：**是利用 select、poll、epoll可以同时监察多个流的 I/O 事件能力，在空闲时会把当前线程阻塞掉，当一个或多个流有 I/O 事件时，就从阻塞中唤醒。于是程序就会轮询一遍所有的流（epoll 是只轮询那些真正发出了事件的流），并且只依次顺序的处理就绪的流，这种做法就避免了大量的无用操作。

**多路**指的是多个我网络连接，**复用**指的是同一个线程。

采用 **多路 I/O 复用模型**可以让单个线程高效的处理多个连接请求（尽量减少网络 IO 的时间消耗），且 Redis 在内存中操作数据的速度非常快，也就是说内存内的操作不会成为影响 Redis 性能的瓶颈。



#### 8. redis hash 中某个 key 过大，变为 String 类型的大 key，怎么处理，使用中如何避免出现这种问题



#### 9. ehcache 支持哪些缓存

key-value



#### 10. 哨兵机制、redis 两种备份方式的区别，项目中用的哪种，为什么



#### 11. 数据库和缓存的一致性问题。先更新数据库，再更新缓存，若更新完数据库了，还没有更新缓存，此时有请求过来了，访问到了缓存中的数据，怎么办？